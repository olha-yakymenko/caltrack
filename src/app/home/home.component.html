<div class="home-container">
  @if (stats$ | async; as stats) {
    <div class="welcome-section">
      <h1>Witaj, {{ stats.userName }}!</h1>
      @if (stats.isPremium) {
        <span class="premium-badge">‚≠ê PREMIUM</span>
      }
    </div>

    @if (stats.isPremium && stats.isActive) {
      <div class="premium-features">
        <button (click)="toggleCalculator()" class="premium-btn">
          @if (showCalculator) {
            ‚úï Zamknij kalkulator
          } @else {
             Otw√≥rz kalkulator kalorii
          }
        </button>
      </div>
    }


    <div class="calorie-circle-wrapper">
      <div class="calorie-ring" [style.background]="getRingGradient(stats.percent, stats.remaining < 0)">
        <div class="inner-circle">
          <span class="remaining-value">{{ stats.remaining > 0 ? stats.remaining : 0 }}</span>
          <span class="remaining-label">Pozosta≈Ço kcal</span>
        </div>
      </div>
    </div>

    <div class="summary-cards">
      <div class="card">
        <p>Cel dzienny</p>
        <strong>{{ stats.limit }} kcal</strong>
      </div>
      <div class="card">
        <p>Zjedzone</p>
        <strong>{{ stats.consumed }} kcal</strong>
      </div>
      <div class="card">
        <p>Procent celu</p>
        <strong>{{ stats.percent | number:'1.0-0' }}%</strong>
      </div>
      @if (stats.remaining < 0) {
        <div class="card warning">
          <p>Przekroczono limit</p>
          <strong>{{ -stats.remaining }} kcal</strong>
        </div>
      }
    </div>

    @if (showCalculator && stats.isPremium && stats.isActive) {
      <div class="calculator-container">
        <app-calorie-calculator
          (calculate)="onCaloriesCalculated($event)"
          (closed)="onCalculatorClose()"
        ></app-calorie-calculator>
      </div>
    }
    
  } @else {
    <div class="login-prompt">
      <h2>üçé ≈öled≈∫ swoje kalorie!</h2>
      <p>Aby zobaczyƒá swoje statystyki i zarzƒÖdzaƒá posi≈Çkami, zaloguj siƒô do konta.</p>
      
      <div class="prompt-actions">
        <a routerLink="/login" class="login-btn">Zaloguj siƒô</a>
        <a routerLink="/register" class="register-btn">Za≈Ç√≥≈º konto</a>
      </div>
      
      <div class="features">
        <h3>üìã Co zyskujesz?</h3>
        <div class="feature-list">
          <div class="feature">
            <div class="feature-icon">üìä</div>
            <div class="feature-content">
              <h4>≈öledzenie kalorii</h4>
              <p>Monitoruj dzienne spo≈ºycie kalorii w czasie rzeczywistym</p>
            </div>
          </div>
          
          <div class="feature">
            <div class="feature-icon">üéØ</div>
            <div class="feature-content">
              <h4>OsiƒÖganie cel√≥w</h4>
              <p>Ustalaj cele i ≈õled≈∫ swoje postƒôpy</p>
            </div>
          </div>
          
          <div class="feature">
            <div class="feature-icon">‚≠ê</div>
            <div class="feature-content">
              <h4>Funkcje Premium</h4>
              <p>Kalkulator zapotrzebowania, planowanie posi≈Çk√≥w, zaawansowana analiza</p>
            </div>
          </div>
        </div>
      </div>
    </div>
  }
</div>